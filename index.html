<!DOCTYPE html>
<html>
<head>
	<!--<meta charset="UTF-8">-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Jayant Parashar | CourierTracker</title>
	<link rel="shortcut icon" href="https://raw.githubusercontent.com/jparasha/jparasha.github.io/master/img/self.png">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="//fonts.googleapis.com/css?family=Cuprum" rel="stylesheet">
	<style>
		htm, body{
			height: 100%;
		}
		body {			
			background-color: #f2f2f2;
			color: black;
			font-family: 'Cuprum', sans-serif, monospace;
		}
		
		.starter-template {
			text-align: center;
		}
		
		.table {
			font-size:large;
			border-radius: 0px; 
			border: 5px solid lightCoral;
			margin-bottom: 10%;
		}
		tbody{
			border: 1px solid lightCoral;	
		}
		
		.spinner {
			margin: 100px auto 0;
			width: 70px;
			text-align: center;
		}
		
		.spinner > div {
			width: 18px;
			height: 18px;
			background-color: lightCoral;
			border-radius: 100%;
			display: inline-block;
			-webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;
			animation: sk-bouncedelay 1.4s infinite ease-in-out both;
		}
		
		.spinner .bounce1 {
			-webkit-animation-delay: -0.32s;
			animation-delay: -0.32s;
		}
		
		.spinner .bounce2 {
			-webkit-animation-delay: -0.16s;
			animation-delay: -0.16s;
		}
		
		@-webkit-keyframes sk-bouncedelay {
			0%,
			80%,
			100% {
				-webkit-transform: scale(0)
			}
			40% {
				-webkit-transform: scale(1.0)
			}
		}
		
		@keyframes sk-bouncedelay {
			0%,
			80%,
			100% {
				-webkit-transform: scale(0);
				transform: scale(0);
			}
			40% {
				-webkit-transform: scale(1.0);
				transform: scale(1.0);
			}
		}
		.top> h3{
			margin-bottom:20px !important;
		}
		.form-group {
			text-align: left;
			padding-left: 5%;
			padding-right: 5%
		}
		.top{		
			padding: 1%;			
			background-color: lightCoral;
			color: white;
			vertical-align:middle;
			margin:0 0 5% 0;
		}
		.foot{
			padding: 2%;			
			background-color: transparent;
			color: lightCoral;
		}
		.footChanger{
			padding: 1%;			
			background-color: lightCoral;
			color: white;
		}
		thead{
			background-color: lightCoral !important;
			color: white !important;
		}
		thead>tr>td {
			border: 1px solid white !important;
			padding: 2% 0%;
			font-size: x-large;
		}
		td{
			border: 1px solid lightCoral !important;
		}
		.form-control{
			padding: 1% 2%;
			height: auto;
			font-weight: bold;
			border-radius: 0px !important;
		}
		.btn{
			border-radius: 0px;
		}
		a{
			color: royalblue;
		}
		a:focus, a:hover{
			color: brown;
		}
		.tile{
			margin:2% 2% 0% 2%;
			font-size:150%;
		}
		.data{
			margin-top: 3%;
		}
		.btn:focus,.btn:active {
		   outline: none !important;
		}
		@media (max-width: 600px) {		
			.tile{
				margin:2% 2% 0% 2%;
				font-size:80%;
			}					
			.data{
				margin-bottom: 30%;
			}
			.exp{
				margin-top:10% !important;
			}
			.table{
				font-size:inherit !important;
				padding:1% !important;
			}
			thead>tr>td{
				font-size: medium;
			}
			.strng{
				font-size: medium;
				font-weight: inherit !important;
			}
			.navbar-fixed-bottom {
				position:relative !important;
				margin-top: 20%;
			}
		}
		
	</style>
</head
<body>
	<div class="top col-lg-12 col-sm-12 col-md-12">
		<h3 style="margin-left: 2%; font-weight: bold;">C O U R I E R - B U D D Y</h3>

	</div>
	<div class="container col-lg-12 col-md-12 col-sm-12">
		<div class="starter-template">			
			<form method="get" action="" class="form ">
				<div class="form-group ">
					<label for="code">T R A C K I N G - C O D E :</label>
					<input type="text" class="form-control" id="code" placeholder="Something Like : 'GGN50335013'">
				</div>

				<div class="form-group left" style="margin-top:2%">
					<label for="slug">S E L E C T - C O U R I E R :</label>
					<select class="form-control" id="slug">
						<option value="professional-couriers" class="form-group">PROFESSIONAL COURIERS</option>
						<option value="dtdc" class="form-group">DTDC</option>
						<option value="bluedart">BLUE DART</option>
						<option value="first-flight">FIRST FLIGHT</option>
						<option value="india-post">INDIA POST</option>
						<option value="fedex">FEDEX</option>
						<option value="dhl">DHL INTERNATIONAL</option>
					</select>
				</div>				
			</form>
			<button onClick="getTracking()" type="button" class="btn btn-primary" style="margin-top:2%; padding: 1% 4%; background-color: lightCoral; border : 1px solid #f08080 ;font-size: large; "><strong>T R A C K</strong></button>
		</div>
		<div class="" id="spinner" style="margin-top:2%">
			<div class="" id="bounce1"></div>
			<div class="" id="bounce2"></div>
			<div class="" id="bounce3"></div>
		</div>
		<div class="exp col-lg-12 col-md-12 col-sm-12 tile" id="exp" ></div>
		<div class="exp2 col-lg-12 col-md-12 col-sm-12 tile" id="exp2"></div>
		<div class="data col-lg-12 col-md-12 col-sm-12" id="data"></div>
	</div>
	<div class=" navbar-fixed-bottom foot col-lg-12 col-sm-12 col-md-12" id="foot">
		<footer class="text-center">All rights Reserved. site design / logo &copy; 2017 Jayant Parashar, &nbsp;All Icons/Names/Logos belong to respective owners. Contributions licensed under <a href="https://creativecommons.org/licenses/by-sa/3.0/">cc by-sa 3.0.</a></footer>
	</div>
</body>
	
	<script type="text/javascript">									
											
		function getTracking() {

			var nums=0;
			var element1 = document.getElementById("spinner");
			var element2 = document.getElementById("bounce1");
			var element3 = document.getElementById("bounce2");
			var element4 = document.getElementById("bounce3");
			document.getElementById("exp2").innerHTML = "";

			var code = document.getElementById("code").value;
			var slug = document.getElementById("slug").value;
			if (code === "" || code === "null") {
				document.getElementById("data").innerHTML = "";
				document.getElementById("exp").innerHTML = "<strong style='margin-left:2%;' class='strng'>P L E A S E &nbsp;&nbsp;  E N T E R &nbsp;&nbsp; A &nbsp;&nbsp;  V A L I D &nbsp;&nbsp; T R A C K I N G &nbsp;&nbsp; C O D E &nbsp;!</strong>";
			} 
			else {
				document.getElementById("data").innerHTML = "";
				document.getElementById("exp").innerHTML = "";
				element1.classList.add("spinner");
				element2.classList.add("bounce1");
				element3.classList.add("bounce2");
				element4.classList.add("bounce3");
				call();	
				
				function call(){
					var mainData;
					var arr=[];
					var url = "https://couriermgmt.herokuapp.com/tracking";
					///var url = "http://localhost:8000/tracking";					
					var bod= {	
									"slug":slug,
									"tracking_number": code
							  };
					var para={"test": "test"};
					para = JSON.stringify(para);

					fetch(url, {				    
							method: "post",
							json: true,
							headers: {
								"content-type": "application/json",
							},
							body: JSON.stringify(bod)
							 }).then(function(response) {
								   return response.json();
							 }).then(function(data) {
								  // console.log(data);
									mainData=data;
									if(data.meta.code === 429){	
										nums++;
										//console.log("429");
										var trying = document.getElementById("exp");
										if(nums<2){
											trying.innerHTML = '<strong style="color:lightCoral; margin-top:1%; margin-left:2%;">' + data.meta.message + '</strong>';
											call();
										}
										else if(nums >= 2 && nums <= 5){
											trying.innerHTML = '<strong style="color:lightCoral; margin-top:1%; margin-left:2%;">' + data.meta.failingMsg + '</strong>';
											call();
										}
										else{
											trying.innerHTML = '<strong style="color:lightCoral; margin-top:1%; margin-left:2%;">' + data.meta.failedMsg + '</strong>';
											//call();
										}
									}
									else if(data.meta.code===200){
											//console.log("200");
											var trackingArray;
											for(var i =0; i<data.data.trackings.length; i++){
												if (data.data.trackings[i].checkpoints.length != 0){
													trackingArray=data.data.trackings[i];
												}
												else{											
													//console.log("t-array empty");
												}
											}
											
										if(trackingArray.checkpoints.length===0 || trackingArray.checkpoints.length === undefined ){
											//console.log("checkpoints 0");
											var doc = document.getElementById("exp");
											element1.classList.remove("spinner");
											element2.classList.remove("bounce1");
											element3.classList.remove("bounce2");
											element4.classList.remove("bounce3");
											doc.innerHTML = '<strong style="color:red; margin-top:2%;" class="strng">Snapp.. That looks like an error/ tracking may have expired! </strong>';
										}
										else{
											//console.log("for loop");
											for (var i = 0; i < trackingArray.checkpoints.length; i++) {
														arr.push(trackingArray.checkpoints[i])
													}
													var updateTime = " Details updated at :  ";
													var updateTimeArray =[];
													var htm = '<table class="table table-hover table-responsive table-bordered" style="padding:5%;"><thead><tr><td>Time</td><td>City/Location</td><td>Status</td></tr></thead><tbody>';
													var outer = '';
													var exp = '  Expected Date Of Delivery: ';
													if (data.data.trackings[0].expected_delivery === null && data.data.trackings[0].tag !="Delivered") {
														exp = exp + '<strong style="color:lightCoral;">C U R R E N T L Y &nbsp;&nbsp; U N A V A I L A B L E !</strong>';
													} 
													else if(data.data.trackings[0].expected_delivery === null && data.data.trackings[0].tag ==="Delivered"){							
													 exp= exp + '<strong style="color:lightCoral;">D E L I V E R E D !</strong>';
													}
													else {
														exp = exp + '<strong style="color:lightCoral;">'+data.data.trackings[0].expected_delivery+'</strong>';
													}
													for (var j = arr.length - 1; j >= 0; --j) {
														var city='';
														if (arr[j].city===null){
															city= arr[j].location;
														}
														else{
															city= arr[j].city;
														}
														var inner = '<tr><td>' + arr[j].checkpoint_time + '</td><td>' + city + '</td><td>' + arr[j].message + '</td></tr>';
														outer = outer + inner;
														updateTimeArray.push(arr[j].created_at);												
													}
													var d = new Date(updateTimeArray[updateTimeArray.length-1]);
														d.toLocaleDateString().replace(/\//g,'-');
													updateTime= updateTime+ '<strong style="color:lightCoral; text-align:right;">'+d+'</strong>';
													var htm = htm + outer + '</tbody></th></table>';
													element1.classList.remove("spinner");
													element2.classList.remove("bounce1");
													element3.classList.remove("bounce2");
													element4.classList.remove("bounce3");
													var doc1 = document.getElementById("exp");
													var doc2 = document.getElementById("exp2");
													var doc = document.getElementById("data");
													var classless = document.getElementById("foot");
													classless.classList.remove("foot");
													classless.classList.add("footChanger");
													doc1.innerHTML = exp;
													doc2.innerHTML = updateTime;
													doc.innerHTML = htm;
													document.getElementById('exp').scrollIntoView();								
										}//track();
									}
									else{
										//console.log("sorry!");
										var trying = document.getElementById("exp");
										trying.innerHTML = '<strong style="color:lightCoral; margin-top:2%;">Well, that is an error! try submitting request again..</strong>';
									}
							   }).catch(function() {
										console.log("error");
										var text="Looks like an error!";
										if (mainData === undefined){
											text= "Something went wrong!"; 
										}
										else{
											text = mainData.meta.message;
										}								
										var doc = document.getElementById("exp");
										element1.classList.remove("spinner");
										element2.classList.remove("bounce1");
										element3.classList.remove("bounce2");
										element4.classList.remove("bounce3");
										doc.innerHTML = '<strong style="color:red; margin-top:2%;">' + text + '</strong>';
									 });					
					}			
			} //else

		} //js
		 
				  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

				  ga('create', 'UA-99377211-2', 'auto');
				  ga('send', 'pageview');

</script>

</script>
		
	</script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


</html>